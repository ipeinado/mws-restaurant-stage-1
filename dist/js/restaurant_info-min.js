let restaurant;var map;window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,setFavButton(e),document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img"),n=DBHelper.imageUrlForRestaurant(e),r="Image of "+e.name+" Restaurant",a="(max-width: 640px) 100vw, 50vw",s=n+"-medium.jpg 570w, "+n+".jpg 800w",i=n+"-medium.webp 570w, "+n+".webp 800w",o=document.createElement("source");o.setAttribute("type","image/webp"),o.setAttribute("srcset",i),o.setAttribute("sizes",a),o.setAttribute("alt",r),t.appendChild(o);const l=document.createElement("source");l.setAttribute("type","image/jpeg"),l.setAttribute("srcset",s),l.setAttribute("sizes",a),l.setAttribute("alt",r),t.appendChild(l);const d=document.createElement("img");d.setAttribute("src",n+".jpg"),d.setAttribute("alt",r),t.appendChild(d),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(),createReviewForm()}),setFavButton=((e=self.restaurant)=>{const t=document.getElementById("favButton");e.is_favorite?(t.innerHTML="&#10084; Remove from favorites",t.setAttribute("class","fav-button favorite")):(t.innerHTML="<span class='heart'>&#10084;</span> Add to favorites",t.setAttribute("class","fav-button non-favorite")),t.addEventListener("click",favButtonClick)}),favButtonClick=((e,t=self.restaurant)=>{e.preventDefault(),t.is_favorite=!t.is_favorite,setFavButton(t),DBHelper.saveRestaurantsLocally([t]).catch(e=>console.log(e));const n=new Headers({"Content-Type":"application/json"});fetch(`http://localhost:1337/restaurants/${t.id}/?is_favorite=${t.is_favorite}`,{method:"put",headers:n}).catch(e=>console.log(e))}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const s=document.createElement("td");s.innerHTML=e[n],r.appendChild(s),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant)=>{const t=document.getElementById("reviews-container"),n=document.getElementById("reviews-list"),r=document.createElement("h3");r.innerHTML="Reviews",t.insertBefore(r,n),DBHelper.fetchReviewsByRestaurant(e.id,(e,n)=>{if(e){const e=document.createElement("p");return e.innerHTML="Sorry, there was a problem downloading the reviews",void t.appendChild(e)}n.length>0&&updateReviewsUI(n)})}),updateReviewsUI=(e=>{const t=document.getElementById("reviews-list");e.forEach(e=>{const n=createReviewHTML(e);t.appendChild(n)})}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p"),r=document.createElement("div"),a=document.createElement("div");r.className="header",a.className="review-content",t.appendChild(r),t.appendChild(a),n.className="reviewer-name",n.innerHTML=e.name,r.appendChild(n);const s=document.createElement("p");s.className="review-date",s.innerHTML=new Date(e.updatedAt).toLocaleDateString("en-US"),r.appendChild(s);const i=document.createElement("p");i.className="review-rating",i.innerHTML=`Rating: ${e.rating}`,a.appendChild(i);const o=document.createElement("p");return o.innerHTML=e.comments,a.appendChild(o),t}),createReviewForm=((e=self.restaurant)=>{const t=document.getElementById("reviews-form"),n=document.createElement("h4");n.innerHTML="Add your review",t.appendChild(n);const r=document.createElement("form");r.setAttribute("method","http://localhost:1337/reviews/"),r.setAttribute("action","post");const a=document.createElement("input");a.setAttribute("id","restaurant_id"),a.setAttribute("name","restaurant_id"),a.setAttribute("type","hidden"),a.setAttribute("value",e.id),r.appendChild(a);const s=document.createElement("div"),i=document.createElement("label");i.setAttribute("for","name"),i.innerHTML="Your Name",s.appendChild(i);const o=document.createElement("input");o.setAttribute("type","text"),o.setAttribute("id","name"),o.setAttribute("name","name"),o.setAttribute("required",""),s.appendChild(o),r.appendChild(s);const l=document.createElement("div"),d=document.createElement("label");d.setAttribute("for","rating"),d.innerHTML="Rating",l.appendChild(d);const c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("id","rating"),c.setAttribute("name","rating"),c.setAttribute("step",1),c.setAttribute("min",1),c.setAttribute("max",5),l.appendChild(c),r.appendChild(l);const u=document.createElement("div"),m=document.createElement("label");m.setAttribute("for","comments"),m.innerHTML="Your comments",u.appendChild(m);const p=document.createElement("textarea");p.setAttribute("id","comments"),p.setAttribute("name","comments"),u.appendChild(p),r.appendChild(u);document.createElement("div");const v=document.createElement("button");v.setAttribute("type","submit"),v.setAttribute("id","submit"),v.setAttribute("class","button"),v.setAttribute("role","button"),v.innerHTML="Submit your review",r.appendChild(v),r.addEventListener("submit",addAndPostReview),t.appendChild(r)}),postReview=(e=>{delete e.is_pending;const t=new Headers({Accept:"application/json","Content-Type":"application/json; charset=utf-8"}),n=JSON.stringify(e);fetch("http://localhost:1337/reviews/",{method:"post",mode:"cors",headers:t,body:n}).then(t=>{if(200!=t.status&&201!=t.status)throw new Error("response status is not 200 or 201");DBHelper.openDB().then(t=>{return t.transaction("reviews","readwrite").objectStore("reviews").put(e)})}).catch(e=>console.log("Could not post the review: "+e))}),addAndPostReview=(e=>{e.preventDefault();const t=new URL(window.location).searchParams.get("id"),n={restaurant_id:parseInt(t,10),name:document.getElementById("name").value,rating:parseInt(document.getElementById("rating").value,10),comments:document.getElementById("comments").value,is_pending:!0};document.getElementById("name").value="",document.getElementById("rating").value="",document.getElementById("comments").value="",updateReviewsUI([n]),DBHelper.saveReviewsLocally([n]).then(e=>console.log("Review saved locally")).catch(e=>console.log("Could not save reviews locally"+e)),"serviceWorker"in navigator&&"SyncManager"in window?(console.log("service worker in navigator etc."),navigator.serviceWorker.ready.then(e=>{e.sync.register("submitReviews")}).catch(e=>{postReview(n)})):postReview(n)}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li"),r=document.createElement("span");r.setAttribute("aria-current","page"),n.appendChild(r),r.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwid2luZG93IiwiaW5pdE1hcCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsImNvbnNvbGUiLCJzZWxmIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ6b29tIiwiY2VudGVyIiwibGF0bG5nIiwic2Nyb2xsd2hlZWwiLCJmaWxsQnJlYWRjcnVtYiIsIkRCSGVscGVyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImNhbGxiYWNrIiwiaWQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiaW5uZXJIVE1MIiwibmFtZSIsInNldEZhdkJ1dHRvbiIsImFkZHJlc3MiLCJwaWN0dXJlIiwiaW1hZ2VfbmFtZSIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImFsdF90ZXh0Iiwic2l6ZXMiLCJzcmNzZXRfanBnIiwic3Jjc2V0X3dlYnAiLCJzb3VyY2UiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiYXBwZW5kQ2hpbGQiLCJpbWdfc3Jjc2V0IiwiaW1nIiwiY3Vpc2luZV90eXBlIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJjcmVhdGVSZXZpZXdGb3JtIiwiZmF2QnV0dG9uIiwiaXNfZmF2b3JpdGUiLCJhZGRFdmVudExpc3RlbmVyIiwiZmF2QnV0dG9uQ2xpY2siLCJldmVudCIsInByZXZlbnREZWZhdWx0Iiwic2F2ZVJlc3RhdXJhbnRzTG9jYWxseSIsImNhdGNoIiwiZXJyIiwibG9nIiwiaGVhZGVycyIsIkhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJmZXRjaCIsIm1ldGhvZCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJ0aW1lIiwiY29udGFpbmVyIiwidWwiLCJ0aXRsZSIsImluc2VydEJlZm9yZSIsImZldGNoUmV2aWV3c0J5UmVzdGF1cmFudCIsInJldmlld3MiLCJub1Jldmlld3MiLCJsZW5ndGgiLCJ1cGRhdGVSZXZpZXdzVUkiLCJmb3JFYWNoIiwicmV2aWV3IiwiaXRlbSIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsImhlYWRlciIsImNvbnRlbnQiLCJjbGFzc05hbWUiLCJkYXRlIiwiRGF0ZSIsInVwZGF0ZWRBdCIsInRvTG9jYWxlRGF0ZVN0cmluZyIsInJhdGluZyIsImNvbW1lbnRzIiwiZm9ybUNvbnRhaW5lciIsImZvcm0iLCJoaWRkZW5JZCIsImRpdk5hbWUiLCJsYWJlbE5hbWUiLCJpbnB1dE5hbWUiLCJkaXZSYXRpbmciLCJsYWJlbFJhdGluZyIsImlucHV0UmF0aW5nIiwiZGl2Q29tbWVudHMiLCJsYWJlbENvbW1lbnRzIiwiaW5wdXRDb21tZW50cyIsInN1Ym1pdEJ1dHRvbiIsImFkZEFuZFBvc3RSZXZpZXciLCJwb3N0UmV2aWV3IiwiaXNfcGVuZGluZyIsIkFjY2VwdCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwibW9kZSIsInRoZW4iLCJyZXNwb25zZSIsInN0YXR1cyIsIkVycm9yIiwib3BlbkRCIiwiZGIiLCJ0cmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlIiwicHV0IiwicmVzdGF1cmFudF9pZF91cmwiLCJVUkwiLCJsb2NhdGlvbiIsInNlYXJjaFBhcmFtcyIsImdldCIsImRhdGEiLCJyZXN0YXVyYW50X2lkIiwicGFyc2VJbnQiLCJ2YWx1ZSIsInNhdmVSZXZpZXdzTG9jYWxseSIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWFkeSIsInJlZyIsInN5bmMiLCJyZWdpc3RlciIsImJyZWFkY3J1bWIiLCJzcGFuIiwidXJsIiwiaHJlZiIsInJlcGxhY2UiLCJyZXN1bHRzIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6IkFBQUEsSUFB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LFFBQVFrRCxJQUFJLHlCQUM3QkYsTUFBTUMsR0FBT2pELFFBQVFrRCxJQUFJLGlDQUFtQ0QsSUFFM0Qsa0JBQW1CNEUsV0FBYSxnQkFBaUJqSSxRQUNuREksUUFBUWtELElBQUksb0NBQ1oyRSxVQUFVQyxjQUFjQyxNQUNyQnJCLEtBQUtzQixJQUNKQSxFQUFJQyxLQUFLQyxTQUFTLG1CQUVuQmxGLE1BQU1DLElBRUxrRCxXQUFXcUIsTUFJZnJCLFdBQVdxQixLQU9mN0csZUFBaUIsRUFBQ2pCLEVBQVdPLEtBQUtQLGNBQ2hDLE1BQU15SSxFQUFhOUgsU0FBU0MsZUFBZSxjQUNyQ3FFLEVBQUt0RSxTQUFTMEIsY0FBYyxNQUM1QnFHLEVBQU8vSCxTQUFTMEIsY0FBYyxRQUNwQ3FHLEVBQUtwRyxhQUFhLGVBQWdCLFFBQ2xDMkMsRUFBRzFDLFlBQVltRyxHQUNmQSxFQUFLakgsVUFBWXpCLEVBQVcwQixLQUM1QitHLEVBQVdsRyxZQUFZMEMsS0FNekIzRCxtQkFBcUIsRUFBQ0ksRUFBTWlILEtBQ3JCQSxJQUNIQSxFQUFNekksT0FBT3lILFNBQVNpQixNQUN4QmxILEVBQU9BLEVBQUttSCxRQUFRLFVBQVcsUUFDL0IsTUFDRUMsRUFEWSxJQUFJQyxjQUFjckgsc0JBQ2RzSCxLQUFLTCxHQUN2QixPQUFLRyxFQUVBQSxFQUFRLEdBRU5HLG1CQUFtQkgsRUFBUSxHQUFHRCxRQUFRLE1BQU8sTUFEM0MsR0FGQSIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xudmFyIG1hcDtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5mZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpXG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cbiAgc2V0RmF2QnV0dG9uKHJlc3RhdXJhbnQpO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXG4gIGNvbnN0IHBpY3R1cmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcbiAgY29uc3QgaW1hZ2VfbmFtZSA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgY29uc3QgYWx0X3RleHQgPSAnSW1hZ2Ugb2YgJyArIHJlc3RhdXJhbnQubmFtZSArICcgUmVzdGF1cmFudCc7XG4gIGNvbnN0IHNpemVzID0gJyhtYXgtd2lkdGg6IDY0MHB4KSAxMDB2dywgNTB2dyc7XG5cbiAgY29uc3Qgc3Jjc2V0X2pwZyA9IGltYWdlX25hbWUgKyAnLW1lZGl1bS5qcGcgNTcwdywgJyArIGltYWdlX25hbWUgKyAnLmpwZyA4MDB3JztcbiAgY29uc3Qgc3Jjc2V0X3dlYnAgPSBpbWFnZV9uYW1lICsgJy1tZWRpdW0ud2VicCA1NzB3LCAnICsgaW1hZ2VfbmFtZSArICcud2VicCA4MDB3JztcblxuICBjb25zdCBzb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgc291cmNlLnNldEF0dHJpYnV0ZSgndHlwZScsICdpbWFnZS93ZWJwJyk7XG4gIHNvdXJjZS5zZXRBdHRyaWJ1dGUoJ3NyY3NldCcsIHNyY3NldF93ZWJwKTtcbiAgc291cmNlLnNldEF0dHJpYnV0ZSgnc2l6ZXMnLCBzaXplcyk7XG4gIHNvdXJjZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIGFsdF90ZXh0KTtcblxuICBwaWN0dXJlLmFwcGVuZENoaWxkKHNvdXJjZSk7XG5cbiAgY29uc3QgaW1nX3NyY3NldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xuICBpbWdfc3Jjc2V0LnNldEF0dHJpYnV0ZSgndHlwZScsICdpbWFnZS9qcGVnJyk7XG4gIGltZ19zcmNzZXQuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBzcmNzZXRfanBnKTtcbiAgaW1nX3NyY3NldC5zZXRBdHRyaWJ1dGUoJ3NpemVzJywgc2l6ZXMpO1xuICBpbWdfc3Jjc2V0LnNldEF0dHJpYnV0ZSgnYWx0JywgYWx0X3RleHQpO1xuXG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoaW1nX3NyY3NldCk7XG5cbiAgY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGltZy5zZXRBdHRyaWJ1dGUoJ3NyYycsIGltYWdlX25hbWUgKyAnLmpwZycpO1xuICBpbWcuc2V0QXR0cmlidXRlKCdhbHQnLCBhbHRfdGV4dCk7XG5cbiAgcGljdHVyZS5hcHBlbmRDaGlsZChpbWcpO1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XG5cbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgfVxuICAvLyBmaWxsIHJldmlld3NcbiAgZmlsbFJldmlld3NIVE1MKCk7XG5cbiAgLy8gY3JlYXRlIHJldmlldyBmb3JtXG4gIGNyZWF0ZVJldmlld0Zvcm0oKTtcbn1cblxuLyoqXG4gKiBTZXQgZmF2b3JpdGUgYnV0dG9uXG4gKi9cbnNldEZhdkJ1dHRvbiA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGZhdkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZmF2QnV0dG9uXCIpO1xuICBpZiAocmVzdGF1cmFudC5pc19mYXZvcml0ZSkge1xuICAgIGZhdkJ1dHRvbi5pbm5lckhUTUwgPSBcIiYjMTAwODQ7IFJlbW92ZSBmcm9tIGZhdm9yaXRlc1wiO1xuICAgIGZhdkJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2Zhdi1idXR0b24gZmF2b3JpdGUnKTtcbiAgfSBlbHNlIHtcbiAgICBmYXZCdXR0b24uaW5uZXJIVE1MID0gXCI8c3BhbiBjbGFzcz0naGVhcnQnPiYjMTAwODQ7PC9zcGFuPiBBZGQgdG8gZmF2b3JpdGVzXCI7XG4gICAgZmF2QnV0dG9uLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnZmF2LWJ1dHRvbiBub24tZmF2b3JpdGUnKTtcbiAgfVxuICBmYXZCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmYXZCdXR0b25DbGljayk7XG59XG5cbi8qKlxuICogIENsaWNrIGZhdm9yaXRlIGJ1dHRvblxuICovXG4gZmF2QnV0dG9uQ2xpY2sgPSAoZXZlbnQsIHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9ICFyZXN0YXVyYW50LmlzX2Zhdm9yaXRlO1xuICBzZXRGYXZCdXR0b24ocmVzdGF1cmFudCk7XG4gIFxuICAvLyBVcGRhdGUgcmVjb3JkIGluIGxvY2FsIGRhdGFiYXNlXG4gIERCSGVscGVyLnNhdmVSZXN0YXVyYW50c0xvY2FsbHkoW3Jlc3RhdXJhbnRdKVxuICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XG4gIFxuICAvLyBVcGRhdGUgcmVjb3JkIGluIHNlcnZlclxuICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9KTtcbiAgZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8ke3Jlc3RhdXJhbnQuaWR9Lz9pc19mYXZvcml0ZT0ke3Jlc3RhdXJhbnQuaXNfZmF2b3JpdGV9YCxcbiAgICB7bWV0aG9kOiAncHV0JywgaGVhZGVyczogaGVhZGVyc30pXG4gICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTtcbiB9IFxuXG5cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXZpZXdzSFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpLFxuICAgICAgICB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgXG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuXG4gIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUodGl0bGUsIHVsKTtcblxuICBEQkhlbHBlci5mZXRjaFJldmlld3NCeVJlc3RhdXJhbnQocmVzdGF1cmFudC5pZCwgKGVycm9yLCByZXZpZXdzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ1NvcnJ5LCB0aGVyZSB3YXMgYSBwcm9ibGVtIGRvd25sb2FkaW5nIHRoZSByZXZpZXdzJztcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIElmIHRoZXJlIGFyZSBhbnkgcmV2aWV3c1xuICAgIGlmIChyZXZpZXdzLmxlbmd0aCA+IDApIHtcbiAgICAgIHVwZGF0ZVJldmlld3NVSShyZXZpZXdzKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiogVXBkYXRlIHJldmlld3MgaW4gdGhlIHJlc3RhdXJhbnRzIHBhZ2VcbiovXG51cGRhdGVSZXZpZXdzVUkgPSAocmV2aWV3cykgPT4ge1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgXG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgIGNvbnN0IGl0ZW0gPSBjcmVhdGVSZXZpZXdIVE1MKHJldmlldyk7XG4gICAgdWwuYXBwZW5kQ2hpbGQoaXRlbSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgaGVhZGVyLmNsYXNzTmFtZSA9ICdoZWFkZXInO1xuICBjb250ZW50LmNsYXNzTmFtZSA9ICdyZXZpZXctY29udGVudCc7XG4gIGxpLmFwcGVuZENoaWxkKGhlYWRlcik7XG4gIGxpLmFwcGVuZENoaWxkKGNvbnRlbnQpO1xuXG4gIG5hbWUuY2xhc3NOYW1lID0gJ3Jldmlld2VyLW5hbWUnO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBoZWFkZXIuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgZGF0ZS5jbGFzc05hbWUgPSAncmV2aWV3LWRhdGUnO1xuICBkYXRlLmlubmVySFRNTCA9IG5ldyBEYXRlKHJldmlldy51cGRhdGVkQXQpLnRvTG9jYWxlRGF0ZVN0cmluZyhcImVuLVVTXCIpO1xuICBoZWFkZXIuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmcuY2xhc3NOYW1lID0gJ3Jldmlldy1yYXRpbmcnO1xuICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XG4gIGNvbnRlbnQuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBjb250ZW50LmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuICByZXR1cm4gbGk7XG59XG5cbi8qKlxuKiBjcmVhdGUgcmV2aWV3Rm9ybVxuKi9cbmNyZWF0ZVJldmlld0Zvcm0gPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBmb3JtQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtZm9ybScpO1xuXG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDQnKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gXCJBZGQgeW91ciByZXZpZXdcIjtcblxuICBmb3JtQ29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcblxuICBjb25zdCBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9ybScpO1xuICBmb3JtLnNldEF0dHJpYnV0ZSgnbWV0aG9kJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzLycpO1xuICBmb3JtLnNldEF0dHJpYnV0ZSgnYWN0aW9uJywgJ3Bvc3QnKTtcblxuICBjb25zdCBoaWRkZW5JZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIGhpZGRlbklkLnNldEF0dHJpYnV0ZSgnaWQnLCAncmVzdGF1cmFudF9pZCcpO1xuICBoaWRkZW5JZC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAncmVzdGF1cmFudF9pZCcpO1xuICBoaWRkZW5JZC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnaGlkZGVuJyk7XG4gIGhpZGRlbklkLnNldEF0dHJpYnV0ZSgndmFsdWUnLCByZXN0YXVyYW50LmlkKTtcblxuICBmb3JtLmFwcGVuZENoaWxkKGhpZGRlbklkKTtcblxuICBjb25zdCBkaXZOYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgY29uc3QgbGFiZWxOYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgbGFiZWxOYW1lLnNldEF0dHJpYnV0ZSgnZm9yJywgJ25hbWUnKTtcbiAgbGFiZWxOYW1lLmlubmVySFRNTCA9ICdZb3VyIE5hbWUnO1xuICBkaXZOYW1lLmFwcGVuZENoaWxkKGxhYmVsTmFtZSk7XG5cbiAgY29uc3QgaW5wdXROYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgaW5wdXROYW1lLnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0Jyk7XG4gIGlucHV0TmFtZS5zZXRBdHRyaWJ1dGUoJ2lkJywgJ25hbWUnKTtcbiAgaW5wdXROYW1lLnNldEF0dHJpYnV0ZSgnbmFtZScsICduYW1lJyk7XG4gIGlucHV0TmFtZS5zZXRBdHRyaWJ1dGUoJ3JlcXVpcmVkJywgJycpO1xuICBkaXZOYW1lLmFwcGVuZENoaWxkKGlucHV0TmFtZSk7XG5cbiAgZm9ybS5hcHBlbmRDaGlsZChkaXZOYW1lKTtcblxuICBjb25zdCBkaXZSYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICBjb25zdCBsYWJlbFJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIGxhYmVsUmF0aW5nLnNldEF0dHJpYnV0ZSgnZm9yJywgJ3JhdGluZycpO1xuICBsYWJlbFJhdGluZy5pbm5lckhUTUwgPSAnUmF0aW5nJztcbiAgZGl2UmF0aW5nLmFwcGVuZENoaWxkKGxhYmVsUmF0aW5nKTtcblxuICBjb25zdCBpbnB1dFJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIGlucHV0UmF0aW5nLnNldEF0dHJpYnV0ZSgndHlwZScsICdudW1iZXInKTtcbiAgaW5wdXRSYXRpbmcuc2V0QXR0cmlidXRlKCdpZCcsICdyYXRpbmcnKTtcbiAgaW5wdXRSYXRpbmcuc2V0QXR0cmlidXRlKCduYW1lJywgJ3JhdGluZycpO1xuICBpbnB1dFJhdGluZy5zZXRBdHRyaWJ1dGUoJ3N0ZXAnLCAxKTtcbiAgaW5wdXRSYXRpbmcuc2V0QXR0cmlidXRlKCdtaW4nLCAxKTtcbiAgaW5wdXRSYXRpbmcuc2V0QXR0cmlidXRlKCdtYXgnLCA1KTtcbiAgZGl2UmF0aW5nLmFwcGVuZENoaWxkKGlucHV0UmF0aW5nKTtcblxuICBmb3JtLmFwcGVuZENoaWxkKGRpdlJhdGluZyk7XG5cbiAgY29uc3QgZGl2Q29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICBjb25zdCBsYWJlbENvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgbGFiZWxDb21tZW50cy5zZXRBdHRyaWJ1dGUoJ2ZvcicsICdjb21tZW50cycpO1xuICBsYWJlbENvbW1lbnRzLmlubmVySFRNTCA9ICdZb3VyIGNvbW1lbnRzJztcbiAgZGl2Q29tbWVudHMuYXBwZW5kQ2hpbGQobGFiZWxDb21tZW50cyk7XG5cbiAgY29uc3QgaW5wdXRDb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7XG4gIGlucHV0Q29tbWVudHMuc2V0QXR0cmlidXRlKCdpZCcsICdjb21tZW50cycpO1xuICBpbnB1dENvbW1lbnRzLnNldEF0dHJpYnV0ZSgnbmFtZScsICdjb21tZW50cycpO1xuXG4gIGRpdkNvbW1lbnRzLmFwcGVuZENoaWxkKGlucHV0Q29tbWVudHMpO1xuICBmb3JtLmFwcGVuZENoaWxkKGRpdkNvbW1lbnRzKTtcblxuICBjb25zdCBkaXZCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgc3VibWl0QnV0dG9uLnNldEF0dHJpYnV0ZSgndHlwZScsICdzdWJtaXQnKTtcbiAgc3VibWl0QnV0dG9uLnNldEF0dHJpYnV0ZSgnaWQnLCAnc3VibWl0Jyk7XG4gIHN1Ym1pdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2J1dHRvbicpO1xuICBzdWJtaXRCdXR0b24uc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpO1xuICBzdWJtaXRCdXR0b24uaW5uZXJIVE1MID0gJ1N1Ym1pdCB5b3VyIHJldmlldyc7XG5cbiAgZm9ybS5hcHBlbmRDaGlsZChzdWJtaXRCdXR0b24pO1xuXG4gIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgYWRkQW5kUG9zdFJldmlldyk7XG5cbiAgZm9ybUNvbnRhaW5lci5hcHBlbmRDaGlsZChmb3JtKTtcbn1cblxucG9zdFJldmlldyA9IChyZXZpZXcpID0+IHtcbiAgZGVsZXRlIHJldmlldy5pc19wZW5kaW5nO1xuXG4gIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycyh7J0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJywgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04J30pO1xuICBjb25zdCBib2R5ID0gSlNPTi5zdHJpbmdpZnkocmV2aWV3KTtcblxuICBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MvJywge1xuICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgIG1vZGU6ICdjb3JzJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgIGJvZHk6IGJvZHlcbiAgfSkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgLy8gSWYgdGhlIHJlc3BvbnNlIGlzIG9rLCByZW1vdmUgdGhlIGlzX3BlbmRpbmcgZmxhZyBhbmQgdXBkYXRlIHRoZSByZWNvcmQgaW4gdGhlIGRhdGFiYXNlXG4gICAgaWYgKChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB8fCAocmVzcG9uc2Uuc3RhdHVzID09IDIwMSkpIHtcbiAgICAgIERCSGVscGVyLm9wZW5EQigpLnRoZW4oZGIgPT4ge1xuICAgICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzJywgJ3JlYWR3cml0ZScpO1xuICAgICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXZpZXdzJyk7XG4gICAgICAgIHJldHVybiBzdG9yZS5wdXQocmV2aWV3KTtcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigncmVzcG9uc2Ugc3RhdHVzIGlzIG5vdCAyMDAgb3IgMjAxJylcbiAgICB9XG4gIH0pLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZygnQ291bGQgbm90IHBvc3QgdGhlIHJldmlldzogJyArIGVycikpO1xufVxuXG5cbmFkZEFuZFBvc3RSZXZpZXcgPSAoZXZlbnQpID0+IHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCB1cmwgPSBuZXcgVVJMKHdpbmRvdy5sb2NhdGlvbiksXG4gICAgICAgIHJlc3RhdXJhbnRfaWRfdXJsID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2lkJyk7XG5cbiAgY29uc3QgZGF0YSA9IHtcbiAgICByZXN0YXVyYW50X2lkOiBwYXJzZUludChyZXN0YXVyYW50X2lkX3VybCwgMTApLFxuICAgIG5hbWU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lJykudmFsdWUsXG4gICAgcmF0aW5nOiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0aW5nJykudmFsdWUsIDEwKSxcbiAgICBjb21tZW50czogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnRzJykudmFsdWUsXG4gICAgaXNfcGVuZGluZzogdHJ1ZVxuICB9XG5cbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hbWUnKS52YWx1ZSA9ICcnO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0aW5nJykudmFsdWUgPSAnJztcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnRzJykudmFsdWUgPSAnJztcblxuICAvLyBhcHBlbmQgdGhlIHJldmlldyB0byB0aGUgbGlzdFxuICB1cGRhdGVSZXZpZXdzVUkoW2RhdGFdKTtcblxuICAvLyBzYXZlIHRoZSByZXZpZXcgaW4gdGhlIGxvY2FsIGRhdGFiYXNlXG4gIERCSGVscGVyLnNhdmVSZXZpZXdzTG9jYWxseShbZGF0YV0pXG4gICAgLnRoZW4ocmVzcG9uc2UgPT4gY29uc29sZS5sb2coJ1JldmlldyBzYXZlZCBsb2NhbGx5JykpXG4gICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZygnQ291bGQgbm90IHNhdmUgcmV2aWV3cyBsb2NhbGx5JyArIGVycikpO1xuXG4gIGlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yICYmICdTeW5jTWFuYWdlcicgaW4gd2luZG93KSB7XG4gICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIGluIG5hdmlnYXRvciBldGMuJyk7XG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHlcbiAgICAgIC50aGVuKHJlZyA9PiB7XG4gICAgICAgIHJlZy5zeW5jLnJlZ2lzdGVyKCdzdWJtaXRSZXZpZXdzJyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIC8vIHN5c3RlbSB3YXMgdW5hYmxlIHRvIHJlZ2lzdGVyIGZvciBhIHN5bmMsIHNlbmQgbm9ybWFsXG4gICAgICAgIHBvc3RSZXZpZXcoZGF0YSk7XG4gICAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICAvLyBpZiB0aGVyZSBpcyBubyBzZXJ2aWNlIHdvcmtlclxuICAgIHBvc3RSZXZpZXcoZGF0YSk7XG4gIH1cbn1cblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5maWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50PXNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBzcGFuLnNldEF0dHJpYnV0ZSgnYXJpYS1jdXJyZW50JywgJ3BhZ2UnKTtcbiAgbGkuYXBwZW5kQ2hpbGQoc3Bhbik7XG4gIHNwYW4uaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn1cblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5nZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XG4gIGlmICghdXJsKVxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cylcbiAgICByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKVxuICAgIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn1cbiJdLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLW1pbi5qcyJ9
